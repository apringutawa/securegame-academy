import { NextResponse } from 'next/server';import { readDB, writeDB, uid } from '@lib/db';import { hashPassword, signToken } from '@lib/auth';
export async function POST(req:Request){ const {name,email,password}=await req.json(); if(!name||!email||!password) return NextResponse.json({error:'name, email, password required'},{status:400}); const db=await readDB(); if(db.users.find((u:any)=>u.email===email)) return NextResponse.json({error:'email exists'},{status:409}); const password_hash=await hashPassword(password); const user={id:uid(),name,email,password_hash,role:'user',created_at:new Date().toISOString()}; db.users.push(user); await writeDB(db); const token=signToken({uid:user.id,email:user.email,role:user.role}); return NextResponse.json({token,user:{id:user.id,name,email,role:user.role}},{status:201}); }