import { NextResponse } from 'next/server';import { readDB } from '@lib/db';import { comparePassword, signToken } from '@lib/auth';
export async function POST(req:Request){ const {email,password}=await req.json(); if(!email||!password) return NextResponse.json({error:'email, password required'},{status:400}); const db=await readDB(); const user=db.users.find((u:any)=>u.email===email); if(!user) return NextResponse.json({error:'invalid credentials'},{status:401}); const ok=await comparePassword(password, user.password_hash); if(!ok) return NextResponse.json({error:'invalid credentials'},{status:401}); const token=signToken({uid:user.id,email:user.email,role:user.role}); return NextResponse.json({token,user:{id:user.id,name:user.name,email:user.email,role:user.role}}); }